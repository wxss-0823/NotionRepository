# Go 依赖管理

## Go 项目目录结构

​	一个 Go 语言编写的项目，一般需要包含 3 个文件，分别是 `bin`，`pkg`，`src`。其中 `bin` 中应存放编译完成的文件，`pkg` 中应存放编译好的可执行文件，`src` 中应存放源码。

​	任何一个 Go 项目，只能包含一个包名为 `main` 的文件夹，其中包含一个名为 `main` 的函数作为程序的入口。为了结构清晰，因此将 `main` 包单独作为一个模块。其他模块与 `main` 模块同级，每一个模块中应包含一个依赖说明文件 `go.mod`。每个模块中尽量只包含一个包，可以简单索引。`go.work` 文件应该位于与模块同级。

```tree
.
|-- bin
|-- pkg
`-- src
    |-- main
    |   |-- main.go
    |   `-- go.mod
    |-- Module1
    |   |-- filename1.go
    |   |-- filename2.go
    |   `-- go.mod
    |-- Module2
    |   |-- filename3.go
    |   |-- filename4.go
    |   `-- go.mod
    `-- go.work
```

## Go Module

​	为了方便管理 Go 的本地或者云端包，加入了 Module 控制。通过在终端输入 `go mod init module_name` 初始化模块。该初始化过程实际上只是新建了一个名为 `go.mod` 的文件，文件结构如下：

```go
module module_name

go go_version

require (
  %Path%/module_name1
  %Path%/module_name2
  ...
)
```

​	这样很容易理解，首先文件第一行表示当前模块的名称，第二行表示当前 GO 编译器的版本，其他内容是当前模块的依赖，可以使用绝对路径添加本地或者云端依赖，这些路径将在 `GOPATH` 中无法找到对应包时起作用。

**注意：**一个模块通常具有三种名称，分别是保存模块的文件夹名称，模块定义名称，以及模块所包含的包的名称。上述三种名称理论上没有关系，但是可以设置为同一个名字。

​	但是这样有一个弊端，无论时由于本地路径更改，更换设备，云端路径更改等，任何一种修改都会导致大量的变动。因此引入了 Go Work。

## Go Work

​	为了避免上述所说的由于路径更改，导致依赖大量修改的情况发生，引入了 Go Work 文件，通过在终端输入 `go work init module_name`，可以将对应的模块添加进项目说明。类似的，初始化过程仅仅新建了一个名为 `go.work` 的文件，其内容如下：

```go
go go_verison

use Path1
use Path2
```

​	然而这样并没有解决路径更改导致大量文件修改的问题，换句话说，每一个 `go.mod` 文件中使用的仍然时绝对路径。因此，可以通过为路径添加别名的方式，将全部的绝对路径集中在 `go.work` 文件中，这样每次仅需要修改一个文件中的路径即可。修改如下：

```go
go go_version

replace alias1 v.x.x.x => Path1
replace alias2 v.x.x.x => Path2
```

​	通过这种方式，无论是云端，还是本地，路径更改只需要修改对应的 Path 即可。

**注意：**如果是本地文件，Path 后面不能指定版本；而云端文件，版本可以在云端通过 `tag` 的方式定义。

​	修改了别名之后，对应的 `go.mod` 文件也需要修改。需要将原来的绝对路径修改为别名，这样当项目整体移植时，几乎不需要修改。
