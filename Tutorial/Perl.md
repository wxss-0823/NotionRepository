# Perl 教程

## 1. Perl 基础语法

### 1.1. 交互式编程

```shell
perl -e 'print "Hello World\n"'
```

### 1.2. 脚本式编程

```perl
# path

print "Hello World\n"
```

### 1.3. 脚本文件

​	Perl 代码可以写在一个文本文件中，以 `.pl`，`.PL` 作为结尾。文件名可以包含数字，符号和字母，但不能包含空格，可以使用下划线 `_` 来代替空格。

### 1.4. 注释

​	Perl 注释的方法为在语句的开头用字符 `#` 。

```perl
# 这一行是 Perl 中的注释
```

​	Perl 也支持多行注释，最常用的方法是使用 POD（Plain Old Documentations）来进行多行注释。

```perl
=pod 注释
...
...
=cut
```

**注意**：

- `-pod`，`-cut` 只能在行首；
- 以 `=` 开头，以 `=cut` 结尾；
- `=` 后面要紧接一个字符，`=cut` 后面可以不用。

### 1.5. Perl 中的空白

​	Perl 解释器不会关心有多少个空白。所有类型的空白，如：空格、tab、空行等，如果在引号外，解释器会忽略它，如果在引号内，会原样输出。

### 1.6. 引号

​	Perl 输出字符串可以使用单引号和双引号，双引号可以正常解析转义字符和变量，单引号无法解析，会原样输出。

### 1.7. Here 文档

​	Here 文档又称作 heredoc、hereis、here-string 或 、here-script，是一种在命令行和程序语言里定义一个字符串的方法。

```perl
# 使用双引号输出
$var = <<"EOF"
...
...
EOF

$var = <<"EOF"
...
...
EOF
```

- `$var = <<"EOF"` 必须后接分号，否则编译不过；
- `EOF` 可以用任何其他字符代替，只需保证结束标识与开始标识一致；
- 结束标识必须顶个独自占一行；
- 开始表似乎可以不带引号，或带单双引号，不带引号和带双引号效果一致，解释内嵌的变量和转移符号，带单引号则不解释内嵌的变量和转移符号；
- 当内容需要内嵌引号时，不需要加转义符，本身对单双引号转义。

### 1.8. 转义字符

​	如果需要输出一个特殊的字符，可以使用反斜线 `\` 来转义。

### 1.9. Perl 标识符

​	Perl 标识符时用户编程时使用的名字，在程序中使用的变量名、常量名、函数名，语句块名等统称为标识符。

- 标识符组成单元：英文字符（a ~ z，A ~ Z），数字（0 ~ 9）和下划线 `_` ；
- 标识符由英文字符或下划线开头；
- 标识符区分大小写。

## 2. Perl 数据类型

​	Perl 是一种弱类型语言，所以变量不需要指定类型，Perl 解释器会根据上下文自动选择匹配类型。

### 2.1. 标量

​	标量是 Perl 语言中最简单的一种数据类型，这种数据类型的变量可以是数字，字符串，浮点数，不做严格的区分。在使用时，在变量的名字前面加一个 `$` ，表示是标量。

#### 2.1.1. 整型

​	Perl 实际上把整数存在计算机的浮点寄存器中，所以实际上被当作浮点数看待。8 进制以 0 开始，16 进制以 0x 开始。

```perl
$x = 12345;
```

#### 2.1.2. 浮点数

​	浮点寄存器通常不能精确的存储浮点数，从而产生误差，在运算和比较中要特别注意，指数的范围通常为 -309 到 +308。

```perl
$value = 9.01e+21 + 0.01 -9.01e+21;
```

#### 2.1.3. 字符串

​	Perl 中的字符串使用一个标量来表示，定义方式和 C 很像，但不是以 `\0` 结束。

#### 2.1.4. 特殊字符

​	特殊字符是特殊的标记，不能写在字符串中。

- `__FILE__`：文件名；
- `__LINE__`：行号；
- `__PACKAGE__`：包名。

#### 2.1.5. v 字符串

​	一个以 v 开头，后面跟着一个或多个用句点分隔的整数，会被当做一个字串文本。每一个整数对应一个字符。

### 2.2. 数组

​	数组变量以字符 `@` 开头，索引从 0 开始。

```perl
@array = (1,2,3);
```

#### 2.2.1. 创建数组

​	数组变量以 `@` 符号开始，元素放在括号内，也可以以 `qw` 开始定义数组。

```perl
@array = (val1, val2, ...);
@array = qw/val1 val2 val3/;
```

#### 2.2.2. 访问数组元素

​	访问数组元素使用 `$array_name[index]` 的格式来读取。 

#### 2.2.3. 数组序列号

​	Perl 提供了可以按序列输出的数组形式，格式为：起始值 + .. + 终止值。

```perl
@var = (1..10); # var: 1, 2, 3, ..., 10
```

#### 2.3.4. 数组大小

​	数组大小由数组中的标量上下文决定。数组长度返回的是数组的物理大小，而不是元素的个数。

```perl
@array = (1, 2, 3);
print scalar @array;	# 数组大小为 3
@array[50] = 4;
$size = @array;				# 数组物理大小为 51，个数为 4
$max_index = $#array	# 特殊运算符 $#，返回数组的最大索引 50
```

#### 2.3.5. 添加和删除

​	Perl 提供了一些有用的函数来添加和删除数组元素。

| 类型                   | 描述                                         |
| ---------------------- | -------------------------------------------- |
| `push @ARRAY, LIST`    | 将列表的值放到数组的末尾                     |
| `pop @ARRAY`           | 删除数组的最后一个值                         |
| `shift @ARRAY`         | 弹出数组第一个值，并返回它，数组索引依次减 1 |
| `unshift @ARRAY, LIST` | 将列表放在数组前面，并返回新数组的元素个数   |

#### 2.3.6. 切割数组

​	指定有效的数组索引值，来切割指定数组。

```perl
@site1 = ...;
@site2 = @site1[1, 2, 3];
```

#### 2.3.7. 替换元素

​	Perl 中数组元素替换使用 `splice()` 函数。

```perl
spilce @ARRAY, OFFSET [, LENGTH [, LIST]]
```

#### 2.3.8. 字符串转数组

​	Perl 中将字符串转换为数组使用 `split()` 函数。

```perl
split [PATTERN [, EXPR [, LIMIT]]]
```

- `PATTERN`：分隔符，默认为空格；
- `EXPR`：指定字符串数；
- `LIMIT`：如果指定该参数，则返回该数组的元素个数。

#### 2.3.9. 数组转字符串

​	Perl 中将数组转换为字符串使用 `join()` 函数。

```perl
join EXPR, LIST
```

- `EXPR`：连接符；
- `LIST`：列表或数组。

#### 2.3.10. 数组排序

​	Perl 中数组排序使用 `sort()` 函数。

```perl
sort [SUBROUTINE] LIST
```

- `SUBROUTINE`：指定规则；
- `LIST`：列表或数组。

**注意**：数组排序是根据 ASCII 数字值来排序，所以最好先将每个元素转换为小写后再排序。

#### 2.3.11. 合并数组

​	数组的元素是以逗号来分隔，也可以使用逗号来合并数组。

```perl
@numbers = (1, 3, (4, 5, 6));
@odd = (1,3,5);
@even = (2,4,6);
@numbers = (@odd, @even);
```

#### 2.3.12. 从列表中选择元素

​	一个列表可以当作一个数组使用，在列表后指定索引值可以读取指定的元素。

```perl
$var = (5,4,3,2,1)[4]
```

### 2.3. 哈希

​	哈希是一个无序的 **key/value** 对集合，可以使用键作为下标获取值。哈希变量以字符 `%` 开头。

```perl
%h = ('a'=>1, 'b'=>2);
```

## 3. Perl 变量

​	变量是存储在内存中的数据，创建一个变量即会在内存上开辟一个空间。解释器会根据变量的类型来决定其在内存中的存储空间。标量以 `$` 开始，数组以 `@` 开始，哈希以 `%` 开始。Perl 为每个变量类型设置了独立的命名空间，所以不同类型的变量可以使用相同的名称。

### 3.1. 创建变量

​	变量不需要显式声明类型，在变量赋值后，解释器会自动分配匹配的类型空间。

### 3.2. 变量上下文

​	所谓上下文：指的是表达式所在的位置。上下文是由等号左边的变量类型决定的。Perl 解释器会根据上席文来决定变量的类型。同一个变量应用于不同的上下文会返回不同的结果。

| 上下文 | 描述                                         |
| ------ | -------------------------------------------- |
| 标量   | 赋值给一个标量变量，在标量上下文右侧计算     |
| 列表   | 赋值给一个数组或哈希，在列表上下文的右侧计算 |
| 布尔   | 查看是否为 true 或 false                     |
| Void   | 不需要返回值                                 |
| 插值   | 仅发生在括号内                               |

4













